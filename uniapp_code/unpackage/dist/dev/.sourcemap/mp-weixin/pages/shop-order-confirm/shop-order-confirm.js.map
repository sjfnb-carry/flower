{"version":3,"sources":["uni-app:///main.js","webpack:///D:/bishe/bs2/uniapp_code/pages/shop-order-confirm/shop-order-confirm.vue?31ae","webpack:///D:/bishe/bs2/uniapp_code/pages/shop-order-confirm/shop-order-confirm.vue?5385","webpack:///D:/bishe/bs2/uniapp_code/pages/shop-order-confirm/shop-order-confirm.vue?1fa7","webpack:///D:/bishe/bs2/uniapp_code/pages/shop-order-confirm/shop-order-confirm.vue?a7a1","uni-app:///pages/shop-order-confirm/shop-order-confirm.vue","webpack:///D:/bishe/bs2/uniapp_code/pages/shop-order-confirm/shop-order-confirm.vue?01fb"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped","data","user","orderGoods","address","total","type","seat","remark","computed","baseUrl","$base","url","totalPrice","map","item","forEach","Number","toFixed","onLoad","onShow","table","res","methods","changePrice","price","$forceUpdate","onSubmitTap","_this","uni","title","content","success","isSuccess","orderStatus","money","i","order","orderid","tablename","userid","goodid","goodname","picture","buynumber","discountprice","discounttotal","tel","consignee","shangjiamingcheng","status","onGroupSubmitTap","peopleNum","groupNo","onAddressTap","$utils","jump"],"mappings":"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","file":"pages/shop-order-confirm/shop-order-confirm.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/shop-order-confirm/shop-order-confirm.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./shop-order-confirm.vue?vue&type=template&id=2c49ae06&\"\nvar renderjs\nimport script from \"./shop-order-confirm.vue?vue&type=script&lang=js&\"\nexport * from \"./shop-order-confirm.vue?vue&type=script&lang=js&\"\nimport style0 from \"./shop-order-confirm.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/shop-order-confirm/shop-order-confirm.vue\"\nexport default component.exports","export * from \"-!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shop-order-confirm.vue?vue&type=template&id=2c49ae06&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shop-order-confirm.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shop-order-confirm.vue?vue&type=script&lang=js&\"","<template>\r\n<view class=\"content\">\r\n<form>\r\n<view v-if=\"seat!=1\" @tap=\"onAddressTap\" class=\"cu-form-group\">\r\n<view class=\"title\">地址</view>\r\n<view v-if=\"address.phone\">\r\n\t<view>\r\n\t\t{{address.name}} {{address.phone}}\r\n\t</view>\r\n\t<view>\r\n\t\t{{address.address}}\r\n\t</view>\r\n</view>\r\n</view>\r\n<view class=\"cu-form-group\">\r\n<view class=\"title\">购买清单</view>\r\n</view>\r\n<view v-for=\"(item,index) in orderGoods \" v-bind:key=\"index\" class=\"cu-form-group\">\r\n<image class=\"avator\" :src=\"baseUrl+item.picture\" mode=\"\"></image>\r\n<view class=\"title\">\r\n<view>{{item.goodname}}</view>\r\n<view v-if=\"seat!=1\">\r\n\tx{{item.buynumber}}\r\n\t<text v-if=\"type==1||type==3\" style=\"margin-left: 30upx;color: red;\">￥{{item.price}}</text>\r\n\t<text v-if=\"type==2\" style=\"margin-left: 30upx;color: red;\">{{item.total}}积分</text>\r\n</view>\r\n<view v-else>\r\n\t{{item.address}}号\r\n\t<text v-if=\"type==1\" style=\"margin-left: 30upx;color: red;\">￥{{item.total}}</text>\r\n\t<text v-if=\"type==2\" style=\"margin-left: 30upx;color: red;\">{{item.total}}积分</text>\r\n</view>\r\n</view>\r\n</view>\r\n<view class=\"cu-form-group\">\r\n<view v-if=\"type==1||type==3\" class=\"title\">总价</view>\r\n<view v-if=\"type==2\" class=\"title\">总积分</view>\r\n<view>\r\n<text v-if=\"type==1||type==3\">￥{{totalPrice}}</text>\r\n<text v-if=\"type==2\">{{total}}积分</text>\r\n</view>\r\n</view>\r\n<view class=\"cu-form-group\">\r\n\t备注\r\n<input v-model=\"remark\" name=\"remark\" style=\"margin-left: 30upx; border-bottom: 1px solid #999999; height: 60upx; font-size: 28rpx;\"></input>\r\n</view>\r\n</form>\r\n<view class=\"padding\" style=\"text-align: center;\">\r\n<button  v-if=\"type==1\" @tap=\"onSubmitTap()\" class=\"bg-red lg\">确认支付</button>\r\n<button  v-if=\"type==2\" @tap=\"onSubmitTap()\" class=\"bg-red lg\">确认兑换</button>\r\n<button  v-if=\"type==3\" @tap=\"onGroupSubmitTap()\" class=\"bg-red lg\">确认支付</button>\r\n</view>\r\n\r\n</view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\ndata() {\r\nreturn {\r\nuser: {},\r\norderGoods: {},\r\naddress: {},\r\ntotal: 0,\r\ntype: 1,\r\nseat: 0,\r\nremark:'',\r\n}\r\n},\r\ncomputed: {\r\nbaseUrl() {\r\nreturn this.$base.url;\r\n},\r\ntotalPrice(){\r\nlet totalPrice = 0;\r\nif(this.seat == 1){\r\nthis.orderGoods.map(item => {\r\nif(this.user.vip=='是'&& this.type!=2){\r\n\ttotalPrice += item.vipprice * item.address.split(',').length;\r\n}else{\r\n\ttotalPrice += item.price * item.address.split(',').length;\r\n}\r\nreturn item\r\n});\r\n\r\n}else {\r\nthis.orderGoods.forEach(item => {\r\nif(this.user.vip=='是'&& this.type!=2){\r\n\ttotalPrice += item.vipprice * item.buynumber;\r\n}else{\r\n\ttotalPrice += item.price * item.buynumber;\r\n\r\n}\r\n});\r\n}\r\nreturn Number(totalPrice).toFixed(2);\r\n},\r\n},\r\nasync onLoad(options) {\r\n\t// console.log(\"是\");\r\nthis.type = options.type\r\nthis.seat = options.seat\r\n// 获取订单信息，座位信息\r\nthis.orderGoods = uni.getStorageSync('orderGoods');\r\nif (this.seat != 1) {\r\nfor (let i = 0; i < this.orderGoods.length; i++) {\r\nif(this.total==0) {\r\n\tif(this.user.vip=='是'){\r\n\t\tthis.total = parseFloat(this.orderGoods[i].vipprice) * this.orderGoods[i].buynumber\r\n\t}else{\r\n\t\tthis.total = parseFloat(this.orderGoods[i].price) * this.orderGoods[i].buynumber\r\n\r\n\t}\r\n} else {\r\n\tif(this.user.vip=='是'){\r\n\t\tthis.total = parseFloat(this.total) + parseFloat(this.orderGoods[i].vipprice) * this.orderGoods[i].buynumber\r\n\r\n\t}else{\r\n\t\tthis.total = parseFloat(this.total) + parseFloat(this.orderGoods[i].price) * this.orderGoods[i].buynumber\r\n\r\n\t}\r\n}\r\n}\r\n}else{\r\nthis.total = parseFloat(this.orderGoods[0].total)\r\nthis.address = this.orderGoods[0].address\r\n}\r\nthis.total= this.total.toFixed(2)\r\nthis.changePrice()\r\n},\r\nasync onShow() {\r\nlet table = uni.getStorageSync(\"nowTable\");\r\nlet res = await this.$api.session(table)\r\nthis.user = res.data\r\nif(this.seat!=1){\r\nlet address = uni.getStorageSync('address')\r\nif(address&&this.user.id==address.userid){\r\nthis.address = uni.getStorageSync('address');\r\n}else{\r\nres = await this.$api.defaultAddress(this.user.id);\r\nres.data?this.address = res.data:'';\r\n}\r\n}\r\n},\r\nmethods: {\r\nchangePrice(){\r\nlet price = 0\r\nthis.orderGoods.forEach(item => {\r\nif(this.seat==1){\r\nprice = item.total\r\n}else {\r\n\tif(this.user.vip=='是'){\r\n\t\tprice = item.vipprice * item.buynumber;\r\n\t}else {\r\n\t\tprice = item.price * item.buynumber;\r\n\r\n\t}\r\n}\r\nitem.total = (price).toFixed(2)\r\n})\r\nthis.$forceUpdate()\r\n},\r\nasync onSubmitTap() {\r\nlet _this = this;\r\nif(_this.seat!=1&&!_this.address.address){\r\n_this.$utils.msg(`请选择地址`);\r\nreturn;\r\n}\r\nlet table = uni.getStorageSync(\"nowTable\");\r\nuni.showModal({\r\ntitle: '提示',\r\ncontent: '是否确认支付',\r\nsuccess: async function(res) {\r\nif (res.confirm) {\r\n// 订单类型\r\nlet type = _this.type;\r\nlet isSuccess = true ;\r\nlet orderStatus = '已支付';\r\nif(type==1){\r\nif (_this.user.money - _this.total < 0) {\r\n_this.$utils.msg('余额不足，请先充值');\r\n\tisSuccess = false;\r\n\torderStatus = '未支付';\r\n}\r\n}else if(type==2){\r\nif (_this.user.jf - _this.total < 0) {\r\n_this.$utils.msg('积分不足，兑换商品失败');\r\n\tisSuccess = false;\r\n\treturn;\r\n}\r\n}\r\nfor (let i = 0; i < _this.orderGoods.length; i++) {\r\n// 如果有限次模块 ，则减少商品的库存信息，不够则提示库存不足\r\n// 当前商品是否相同表\r\nif(_this.orderGoods[i].tablename == `shangpin`){\r\n\t// 获取数量\r\n\tlet res = await _this.$api.info('shangpin', _this.orderGoods[i].goodid);\r\n\t// 单次限次\r\n\tif(res.data.onelimittimes>0){\r\n\t\t// 超过单次限次购买数量\r\n\t\tif(_this.orderGoods[i].buynumber>res.data.onelimittimes){\r\n\t\t _this.$utils.msg(`${_this.orderGoods[i].goodname}超过可购买数量`);\r\n\t\t\tisSuccess = false\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t// 如果库存小于当前购买数量\r\n\tif(res.data.alllimittimes<_this.orderGoods[i].buynumber){\r\n\t_this.$utils.msg(`${_this.orderGoods[i].goodname}已售罄`);\r\n\t\tisSuccess = false\r\n\t\tbreak;\r\n\t}else{\r\n\t\tif(_this.seat!=1){\r\n\t\t\tres.data.alllimittimes = res.data.alllimittimes - _this.orderGoods[i].buynumber;\r\n\t\t\t// 库存充足则减少库存数量\r\n\t\tawait _this.$api.update(`shangpin`,  res.data);\r\n\t\t}else{\r\n\t\t\tres.data.selected =  res.data.selected  + \",\" + _this.orderGoods[i].activeSeat\r\n\t\t\tif(isSuccess){\r\n\t\t\t\t// 更新座位\r\n\t\t\tawait _this.$api.update(`shangpin`,  res.data);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\nlet order =  {\r\norderid: _this.$utils.genTradeNo(),\r\ntablename: _this.orderGoods[i].tablename,\r\n\t\tuserid: _this.user.id,\r\n\t\tgoodid: _this.orderGoods[i].goodid,\r\n\t\tgoodname: _this.orderGoods[i].goodname,\r\n\t\tpicture: _this.orderGoods[i].picture,\r\n\t\tbuynumber: _this.orderGoods[i].buynumber,\r\n\t\tdiscountprice: _this.orderGoods[i].price,\r\n\t\tprice: _this.orderGoods[i].price,\r\n\t\ttotal:_this.user.vip=='是'?_this.orderGoods[i].vipprice* _this.orderGoods[i].buynumber:_this.orderGoods[i].price* _this.orderGoods[i].buynumber,\r\n\t\tdiscounttotal: _this.orderGoods[i].total,\r\n\t\ttype: type,\r\n\t\tremark: _this.remark,\r\n\t\taddress: _this.address.address,\r\n\t\ttel: _this.address.phone,\r\n\t\tconsignee: _this.address.name,\r\n\t\tshangjiamingcheng:_this.orderGoods[i].shangjiamingcheng,\r\nstatus: orderStatus,\r\n\t\t}\r\nif(_this.seat == 1){\r\n\torder['address'] = _this.address;\r\n\tlet buynumber = _this.address.split(\",\").length;\r\n\torder['buynumber'] = buynumber;\r\n\torder['total'] = _this.orderGoods[i].total;\r\n\torder['discounttotal'] = _this.orderGoods[i].total;\r\n}\r\n// 添加订单\r\nawait _this.$api.add('orders', order);\r\nif (_this.orderGoods[i].id) {\r\n\t// 删除购物车对应的模块\r\nawait _this.$api.del('cart', JSON.stringify([_this.orderGoods[i].id]))\r\nuni.removeStorageSync(`cart${_this.orderGoods[i].goodid}${_this.user.id}`)\r\n}\r\n}\r\nif(isSuccess){\r\nif(type==1){\r\n_this.$utils.msgBack('支付成功');\r\n\t// 减少余额\r\n\t_this.user.money = Number((Number(_this.user.money) - Number(_this.totalPrice)).toFixed(2));\r\n\tif(_this.user.jf||_this.user.jf==0){\r\n\t\t_this.user.jf = Number((Number(_this.user.jf) + Number(_this.totalPrice)).toFixed(2));\r\n\t}\r\nawait _this.$api.update(table, _this.user);\r\n}else if(type==2){\r\n_this.$utils.msgBack('兑换成功');\r\n\t// 减少积分\r\n\t_this.user.jf = Number((Number(_this.user.jf) - Number(_this.totalPrice)).toFixed(2));\r\nawait _this.$api.update(table, _this.user);\r\n}\r\n}\r\n}\r\n}\r\n});\r\n},\r\nasync onGroupSubmitTap() {\r\nlet _this = this;\r\nif(!_this.address){\r\n_this.$utils.msg(`请选择地址`);\r\nreturn;\r\n}\r\nlet table = uni.getStorageSync(\"nowTable\");\r\nuni.showModal({\r\ntitle: '提示',\r\ncontent: '是否确认支付',\r\nsuccess: async function(res) {\r\nif (res.confirm) {\r\n// 订单类型\r\nlet type = _this.type;\r\nlet isSuccess = true ;\r\nif (_this.user.money - _this.total < 0) {\r\n_this.$utils.msg('余额不足，请先充值');\r\nisSuccess = false;\r\nreturn;\r\n}\r\nlet peopleNum = 0;\r\nlet groupNo = '';\r\nfor (let i = 0; i < _this.orderGoods.length; i++) {\r\n// 如果有限次模块 ，则减少商品的库存信息，不够则提示库存不足\r\n// 当前商品是否相同表\r\nif(_this.orderGoods[i].tablename == `shangpin`){\r\n\t// 获取数量\r\n\tlet res = await _this.$api.info('shangpin', _this.orderGoods[i].goodid);\r\n\t//团购人数\r\n\tpeopleNum = res.data.curpeople;\r\n\tres.data.curpeople = Number(res.data.curpeople)+1\r\n\tif(res.data.curpeople>=res.data.grouppeople) {\r\n\t\tgroupNo = _this.$utils.genTradeNo()\r\n\t\t//重置拼团人数\r\n\t\tres.data.curpeople = 0;\r\n\t}\r\n\tif(isSuccess){\r\n\tawait _this.$api.update(`shangpin`,  res.data);\r\n\t}\r\n}\r\nlet order =  {\r\norderid: _this.$utils.genTradeNo(),\r\ntablename: _this.orderGoods[i].tablename,\r\n\t\tuserid: _this.user.id,\r\n\t\tgoodid: _this.orderGoods[i].goodid,\r\n\t\tgoodname: _this.orderGoods[i].goodname,\r\n\t\tpicture: _this.orderGoods[i].picture,\r\n\t\tbuynumber: _this.orderGoods[i].buynumber,\r\n\t\tprice: _this.orderGoods[i].price,\r\n\t\ttotal: _this.orderGoods[i].total,\r\n\t\ttype: type,\r\n\t\taddress: _this.address.address,\r\n\t\ttel: _this.address.phone,\r\n\t\tconsignee: _this.address.name,\r\n\t\tshangjiamingcheng:_this.orderGoods[i].shangjiamingcheng,\r\nstatus: '拼团中',\r\n\t\t}\r\n// 添加订单\r\nawait _this.$api.add('orders', order);\r\nif(groupNo) {\r\n\torder.groupno = groupNo\r\n\torder.id = 0;\r\nawait _this.$api.update('orders', order);\r\n}\r\n}\r\nif(isSuccess){\r\nif(groupNo) {\r\n_this.$utils.msgBack('拼团成功啦');\r\n} else {\r\n\tif(peopleNum==0) {\r\n\t_this.$utils.msgBack('开团成功');\r\n\t} else {\r\n\t_this.$utils.msgBack('参团成功');\r\n\t}\r\n}\r\n// 减少余额\r\n_this.user.money = Number((Number(_this.user.money) - Number(_this.totalPrice)).toFixed(2));\r\nif(_this.user.jf||_this.user.jf==0){\r\n\t_this.user.jf = Number((Number(_this.user.jf) + Number(_this.totalPrice)).toFixed(2));\r\n}\r\nawait _this.$api.update(table, _this.user);\r\n}\r\n}\r\n}\r\n});\r\n},\r\nonAddressTap() {\r\nthis.$utils.jump('../shop-address/shop-address');\r\n}\r\n}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.no-coupon{\r\nposition: absolute;\r\nright: 0;\r\nwidth: 100px;\r\nheight: 100px;\r\ntop: 0;\r\n}\r\n.avator {\r\nwidth: 150upx;\r\nheight: 150upx;\r\nmargin: 20upx 0;\r\n}\r\n</style>\r\n","import mod from \"-!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shop-order-confirm.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../java/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shop-order-confirm.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}